<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>3D Modeling and Texturing</title>
    
<link href="css/site.css" media="screen" rel="stylesheet" type="text/css" />
<link href="css/highlight.default.css" media="screen" rel="stylesheet" type="text/css" />
  
<script src="js/jquery.js"></script>
<script src="js/showdown.js" type="text/javascript"></script>

<link rel="icon" type="image/x-icon" href="favicon.ico" />
</head>
<body>
<!--
Write the markdown code below.
A guide to markdown syntax is at http://daringfireball.net/projects/markdown/
-->

<div style="display: none" id="sourcetext">

## Review
- [Tumblr](http://2014ant3012.tumblr.com/)

[Maya 2014 online Help](http://download.autodesk.com/global/docs/maya2014/en_us/)    
Reference: Maya® Studio Projects Texturing and Lighting, Mastering Autodesk Maya 2013.

# Rendering
Rendering is the final stage in the 3D computer graphics production process.
Though the wider context of rendering begins with shading and texturing objects and lighting your scene, the rendering process ends when surfaces, materials, lights, and motion are processed into a final image or image sequence.

As you build your scenes (shade and texture objects, light scenes, position cameras, and so on), you’ll want to visualize your scene many times before you produce the final rendered image or image sequence. This process may involve (depending on your particular project) creating and setting up additional cameras.

The key to rendering is finding a balance between the visual complexity required and the rendering speed that determines how many frames can be rendered in a given period of time.
 
# Global Illumination: indirect illumination

In reality, **when a ray of light hits an opaque surface, it is either absorbed or reflected (or a little of both) by the surface**. If the light ray is reflected, it reenters the environment and continues to bounce off reflected surfaces until it is absorbed by another surface.      
As light rays bounce around in an environment, fewer light rays reach the parts that are hidden in corners, cracks, and crevices. The lack of light in these areas creates a type of shadowing known as **ambient occlusion**. 

Perhaps **80 percent of the illumination** in an environment is contributed by indirect illumination, and simulating its effect is critical to creating realistic renderings.

![gl00](img/maya/rendering/gl/gl.png)

## Mental Ray 
**Mental ray** for Maya offers all the features traditionally expected of **photorealistic rendering** and includes functionality not found in most rendering software.    
mental ray for Maya allows interactive and batch mental ray rendering from within the Maya user interface.    
After you load the mental ray plug-in (and select mental ray as the renderer), the Render menu lists available menu items for mental ray for Maya. As well, the Attribute Editor contains a mental ray section in which you can edit attributes that are used exclusively when rendering with mental ray for Maya.

To use Global Illumination, you must use the mental ray renderer.     
For simulating indirect lighting and ambient occlusion shadowing, there are **Global Illumination, Final Gathering**, and **Ambient Occlusion shaders.** You can use them separately or together. 

## Photon
To use Global Illumination, you must employ **virtual [photons](http://en.wikipedia.org/wiki/Photon)**. In Maya, **spot, point, area,** and **directional** lights generate photons when the **light's Emit Photons attribute** is selected.

![gl02](img/maya/rendering/gl/lid.png) 

When a scene is rendered, photons are traced from each photon-emitting light to surfaces in the scene. If a photon “hits” a surface, that photon is absorbed, reflected, or transmitted (refracted) based on the qualities of the material assigned to the surface. If a photon is reflected or transmitted, it survives with only a portion of its original energy. 

> #### Material: The amount of energy is determined by the **reflection coefficient** which is established by the **reflectivity attribute** of the assigned material. Attributes that establish the surface's **diffuse, color,** and **various specular highlight qualities** have an equal impact. 

If a photon survives a hit and is reflected or transmitted, it continues through the scene until it hits another surface. Once again, the photon is absorbed, reflected, or transmitted. This process continues until the surviving photons are stopped by the **Max Photon Depth attribute**, which defines the number of hits permitted per photon. (Max Photon depth is located in the **Render Settings window / Indirect Lighting tab / Photon Tracing section**)

![gl01](img/maya/rendering/gl/rtd.png)

**Photon Reflections** defines the maximum number of times a photon will reflect in a scene. This attribute is overridden by the Max Photon Depth attribute. The first surface encountered is not included in the count. Photon Refractions functions in the same manner but affects the maximum number of photon refractions.

### Photon map
The photons that are culled in a process known as Russian Roulette and thereby absorbed by the surface have their position, incident direction, and energy stored in a special photon map.

To save a photon map, type a name for the map in the **Photon Map File field** (found in the Photon Map section on the Indirect Lighting tab of the Render Settings window) and create a render (do not add a file extension to the name). When you want to reuse the same map, deselect Rebuild Photon Map. The map is stored in the renderData\mentalray\photonMap directory with the .pmap extension. When you want to overwrite the map, simply select Rebuild Photon Map.

The map Visualizer allows you to see how the photons are cast in the scene.

![gl01_01](img/maya/rendering/gl/phm.png)

### Light's Global Illum Photons attribute
You can lower or raise the default value of 10,000 to decrease or increase quality. 

### Light's Caustic And Global Illumination subsection  
**Photon Color** represents the red, green, and blue components of a photon's energy. 
The RGB values of its color swatch are multiplied by the Photon Intensity attribute to produce Energy R, Energy G, and Energy B attributes.

**Photon Intensity** is a scaling factor used to determine the intensity of photons produced by a light. A value of 0 will turn off photon tracing for the light.

**Exponent** simulates light falloff over distance. The default value of 2 replicates natural, quadratic decay. A value of 1 effectively prevents falloff from occurring. Values higher than 2 create a more rapid falloff by artificially decreasing photon energy with distance.

### The Global Illumination section of the Indirect Lighting tab in the Render Settings window.

![gl03](img/maya/rendering/gl/rid.png) 

**Radius** controls the maximum distance from a surface point that the renderer will seek out photon hits to determine the color of the point in question. If photons hits are within the search region, their energies are averaged. The search regions render as colored discs when the Radius is inappropriately small for a scene or there are an insufficient number of photons present. The default value of 0 allows Maya to automatically pick a Radius based on the scene size.

**Accuracy** sets the maximum number of neighboring photon hits included in the color estimate of a single rendered point. The search for neighboring photon hits is limited to the region established by the Radius attribute. In general, the higher the Accuracy value, the smoother the result. However, Accuracy affects only photon hits that are in close proximity. That is, if the photon count is low or the Radius value is small so that the photon hits are not discovered in the search region, the Accuracy attribute will have no effect on the render.

**Scale** serves as a multiplier for the Photon Intensity attribute of all lights in the scene. If the slider is set to 50 percent gray, all the photons in the scene will be at half intensity.

**Merge Distance** specifies a distance in world space within which overlapping photons are merged. The option is used to reduce the size of photon maps and decrease render times. You should raise this setting by very small increments. It can increase the blotchy look of the render.

## Final Gather 
Final Gather is used alone for outdoor scenes or can be combined with GI for the highest-quality results on interior scenes. Final Gather does require your scene to be properly illuminated with some form of direct lighting for it to produce good results. For a pleasing and accurate simulation, you will need perhaps a minimum one-third to one-half of the scene lit with direct light. However when higher settings are used, it can often take much longer than the rendering itself.

![gl05](img/maya/rendering/gl/fg01.png) 

Final Gather employs a specialized variation of raytracing in which each camera eye ray intersection creates sets of Final Gather rays. The Final Gather rays are sent out in a random direction within a hemisphere. The end result is a render that is able to include bounced light and color bleed.

## Practice Global Illumination and Final Gathering

### Prepare the scene in the right project directory.
- Let's use the Cornell box and its area light set-up.

### Render Settings window
- Choose Mental Ray renderer.
- In the **Global Illumination** section, select the Global Illumination check box. 
- In the **Final Gathering** section, temporarily deselect Final Gathering: temporarily disabling Final Gathering will speed up the render as you adjust the various Global Illumination settings.

### the Attribute Editor tab for the area light
- In the **Caustic And Global Illumination** section, select **Emit Photons**. Render a test. Each dot represents a photon hit. 

- The dot indicates the area of influence the photon has when combining the photon's indirect illumination information with the direct illumination calculation. 

- The dots are colored, indicating that their energy has been influenced by a surface they have bounced off. For example, the red dots indicate a bounce off a nearby red wall. Hence, a major advantage of Global Illumination is the ability to produce **color bleed**. Although Final Gathering is also used to produce bleed, it is generally more subtle.

- Adjust the **Radius** attribute, found in the Global Illumination section of the Render Settings window. By default, Radius is set to 0, which means that Maya automatically selects a Radius value based on the scene size. 

- It's important to adjust **the total number of photons** in the scene at the same time. To do so, adjust the Global Illum Photons value in the Caustic And Global Illumination section of the light's Attribute Editor tab. When raising the Global Illum Photons value, do so incrementally. The more photons that are being traced, the longer the render will take.

- Reactivate **Final Gathering** by selecting the Final Gathering check box. Final Gathering provides additional smoothing to the Global Illumination indirect illumination and helps hide unblended photon hits.

![gl04](img/maya/rendering/gl/fg.png) 

## Caustics
Global illumination simulates light reflected from diffuse surfaces. Caustics simulate light reflected from glossy and reflective surfaces as well as light that passes through refractive transparent materials. Caustics are calculated completely independently from global illumination; however, the workflow is very similar.

![gl06](img/maya/rendering/gl/cst.png) 

## Homework
- Upload your GI rendering image by next class.

____________________

## Review & Inspiration
- [Tumblr](http://2014ant3012.tumblr.com/)

Reference:[Tutorial: Ambient Occlusion in Maya - by Alchemist101](http://www.game-artist.net/forums/spotlight-articles/1317-tutorial-ambient-occlusion-maya-alchemist101.html)  

# Maya to Mental Ray Rendering: Ambient Occlusion
**Ambient occlusion** refers to the blocking of indirect or diffuse light on an object. It refers to the darker areas of the object, typically creases, cracks and crevices. Ambient occlusion is caused by indirect light's inability to bounce around and illuminate areas that are blocked by a nearby object that absorbs the light rays. **These subtle variations in lighting are visual clues for our eyes to detect surface details** and distinctions that would otherwise be washed out and unnoticeable. Ambient occlusion adds realism to your scene by adding shadows in crevices, nooks and crannies, and so on. For each surface point, it calculates how much light is blocked by other geometry.

In the example below, the ice blocks stand out because of the shadowing between them. The cracks between the ice bricks appear darker because the light is blocked by the ice bricks. 

![ao01](img/maya/rendering/comp_igloo_amb_occl_resized.png)

![ao02](img/maya/rendering/comp_occlusion_2.png)![ao03](img/maya/rendering/comp_beautyHead_2.png)![ao03](img/maya/rendering/comp_beauty_occlusion_2.png)
![ao01](img/maya/rendering/comp_occlusion_rays_2.png)

## Usage
When ambient light is used, the objects in your scene may appear to be too bright and geometric detail may become lost. Ambient occlusion solves this problem by subtracting ambient light and adding shadowing.

## Making
#### SETTING UP THE SHADER NETWORK
- First open the hypershade window and from the Maya nodes list MMB drag a Surface Shader node into the work area.   

![aop01](img/maya/rendering/sshd.png)

- Now change it MentalRay nodes, then under the textures tab MMB drag an '**mib\_amb\_occlusion**' node onto the work area.

![aop02](img/maya/rendering/mib.png)

- Now connect the 'OutValue' of the Occlusion node to the 'OutColor' of the surface shader. This is the default connection between these 2 nodes so you can do this by simply holding down Ctrl and MMB dragging the occlusion node over the shader node. 

![aop03](img/maya/rendering/mib_link.png)
       
#### SETTING UP YOUR SCENE
- In order to get good results from Ambient Occlusion the scene environment must be white. To do this open the Outliner window and select the Persp camera. In the attribute editor under the Environment tab slide the Background Color to 100% white.

![aop11](img/maya/rendering/cam.png)

- Now open the Render Globals window and select MentalRay as your renderer and Production as the quality preset. Now change the multipixel filter to "Lanczos". 

![aop12](img/maya/rendering/lanz.png)

- Now close the render Globals window and assign the 'Surface Shader' you have setup to your model. It should turn the model completely black.
#### TWEAKING
- Frame your model and hit render. It should render quickly and look quite grainy.
- Now we need to tweak the settings a little. Open the attribute editor of the Ambient Occlusion node. 
- The first setting to change is 'Samples'. Increasing this will remove the grainy look but will drastically increase render times. 256 samples is good for most objects.
- Do not change the 'Bright' and 'Dark' settings. These affect how light/dark the occlusion value is, but it is a lot better to render with the default extremes and tweak them in Photoshop at a later stage if you need to.
- The spread setting affects how far the occlusion shadow spreads over the surface. Again the default setting of 0.800 is good for most objects, any lower tends to be too extreme, and a high spread can cause darkening problems when it is multiplied over your colour layers in Photoshop.

![aop13](img/maya/rendering/ae.png)

# Baking a texture + another way to create ambient occlusion map
[Tutorial link](http://cgi.tutsplus.com/tutorials/baking-ambient-occlusion-color-and-light-maps-in-maya-using-mentalray--cg-11872)

#### USING YOUR BAKED OCCLUSION MAP
- Once the bake is completed open the project file that you specified earlier.     
- In that folder select RenderData > MentalRay > lightmap > select your baked texture file and open this with Photoshop.      
- Drag the Occlusion bake on top of your model's texture layer(s) and select Multiply as the layer blending mode. You may also want to apply a slight Gaussian blur to your occlusion layer, especially if it being used on an organic surface. For hard sharp edged surfaces like this one no blur was applied.

![exr01](img/maya/rendering/AO11.jpg)

#### BAKING OCCLUSION FROM HIGH RES TO LOW RES MODELS
- Ambient occlusion maps can also be used to compliment normal maps. The occlusion values from a high poly model can be baked to the UV layout of a low poly model. This helps to sell the normal mapped details if used in a subtle way. This function is found in the transfer maps window under lighting/shading in the Render menu set.

![exr02](img/maya/rendering/AO12.jpg), ![exr03](img/maya/rendering/AO15.jpg)

## Render Layer Editor
When a shot is animated in a 3D program on a professional production, it is rarely rendered out as is. Instead, the shot is divided into layers and/or render passes. In Maya, the Render Layer Editor allows you to create and manage various render layers and render passes.

![rp01](img/maya/rendering/comp_car_luminance.png), ![rp02](img/maya/rendering/comp_car_shadow.png)
![rp03](img/maya/rendering/comp_car_reflection.png), 

Final realistic render image:

![ex01](img/maya/rendering/GUID-59AF3E15-AFFB-4ABE-BDCC-EED3B16B0B2F-low.png)

## Render Layout Overview 

**A system of per layer and per object** overrides means that objects can have different shading and rendering attributes on different layers.    
With **render layers**, you can assign any object to multiple layers with a different material on each layer. This lets you create multiple images for each frame, from any combination of Maya's four renderers, third party plug-in renderers, and post- processes such as Fur and Paint Effects. Rendered images can be efficiently organized for output to a compositor. Render layers can be also be rendered to Adobe® Photoshop® (PSD) format, which supports multiple image layers.     
As well, a preview composite of all the layers can be viewed in the Render View.


[Maya help link](http://download.autodesk.com/global/docs/maya2014/en_us/index.html?url=files/Vari_Render_layer_overview.htm,topicNumber=d30e685988)


_______________________

## Final project
- Submit one folder (yourname\_3Dmodeling) which includes one pdf documentation, the final render image (HD size), maya file + textures by June 22 12pm to yoon\_goo@naver.com. Please name all your documentation as (your name\_title)

- Theme: imply your interpretation of 'Memory' & 'Relations' applying multiple textures in a more complex shading network. 
- Review: June 25th, 1:30 pm, X-427. 

______________________________________________

</div>
<div id="wrapper">
	
	<div class="header">
		
		<h1>ANT3012</h1>		
		<a href="index.html">Overview</a><br/>
		<a href="intro.html">Introduction</a><br/><br/>

		<a href="mayafundt.html">Maya Fundamental</a><br/>
		<a href="mayaNURBs.html">Maya NURBs</a><br/>
		<a href="mayaPoly01.html">Maya Polygon I</a><br/>
		<a href="mayaShade.html">Maya Shading & Lighting I</a><br/>
		<a href="maya_vrfilmking.html">Virtual Filmmaking</a><br/>	
		<br/><a href="mayaShade01.html">Maya Shading & Lighting II</a><br/>	
		<a href="mayaTexture.html">Maya Texturing</a><br/>	
		<a href="mayaPoly02.html">Maya Polygon II: Organic Modeling</a><br/>
		<a href="mayaRender.html">Maya Rendering</a><br/>

	</div>
	<div class="section">
		<script type="text/javascript">
		//var converter = new Markdown.Converter();
		var converter = new Showdown.converter();
		document.write(converter.makeHtml($('#sourcetext').text()));
		</script>
	</div>
	
	<div class="footer">HyunKyung (Haru) Ji, 2014</div>
	
</div>
</body>
</html>