<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>3D Modeling and Texturing</title>
    
<link href="css/site.css" media="screen" rel="stylesheet" type="text/css" />
<link href="css/highlight.default.css" media="screen" rel="stylesheet" type="text/css" />
  
<script src="js/jquery.js"></script>
<script src="js/showdown.js" type="text/javascript"></script>

<link rel="icon" type="image/x-icon" href="favicon.ico" />
</head>
<body>
<!--
Write the markdown code below.
A guide to markdown syntax is at http://daringfireball.net/projects/markdown/
-->

<div style="display: none" id="sourcetext">
20131122/27.
[Maya 2014 online Help](http://download.autodesk.com/global/docs/maya2014/en_us/)      
Reference:[Tutorial: Ambient Occlusion in Maya - by Alchemist101](http://www.game-artist.net/forums/spotlight-articles/1317-tutorial-ambient-occlusion-maya-alchemist101.html)  

# Maya Rendering: Ambient Occlusion
**Ambient occlusion** refers to the blocking of indirect or diffuse light on an object. It refers to the darker areas of the object, typically creases, cracks and crevices. Ambient occlusion is caused by indirect light's inability to bounce around and illuminate areas that are blocked by a nearby object that absorbs the light rays. These subtle variations in lighting are visual clues for our eyes to detect surface details and distinctions that would otherwise be washed out and unnoticeable. Ambient occlusion adds realism to your scene by adding shadows in crevices, nooks and crannies, and so on. For each surface point, it calculates how much light is blocked by other geometry.

In the example below, the ice blocks stand out because of the shadowing between them. The cracks between the ice bricks appear darker because the light is blocked by the ice bricks. 

![ao01](img/maya/rendering/comp_igloo_amb_occl_resized.png)

![ao02](img/maya/rendering/comp_occlusion_2.png)![ao03](img/maya/rendering/comp_beautyHead_2.png)![ao03](img/maya/rendering/comp_beauty_occlusion_2.png)
![ao01](img/maya/rendering/comp_occlusion_rays_2.png)

## Usage
When ambient light is used, the objects in your scene may appear to be too bright and geometric detail may become lost. Ambient occlusion solves this problem by subtracting ambient light and adding shadowing.

## Making
#### SETTING UP THE SHADER NETWORK
- First open the hypershade window and from the Maya nodes list MMB drag a Surface Shader node into the work area.   

![aop01](img/maya/rendering/sshd.png)

- Now change it MentalRay nodes, then under the textures tab MMB drag an '**mib__amb__occlusion**' node onto the work area.

![aop02](img/maya/rendering/mib.png)

- Now connect the 'OutValue' of the Occlusion node to the 'OutColor' of the surface shader. This is the default connection between these 2 nodes so you can do this by simply holding down Ctrl and MMB dragging the occlusion node over the shader node. 

![aop03](img/maya/rendering/mib_link.png)
       
#### SETTING UP YOUR SCENE
- In order to get good results from Ambient Occlusion the scene environment must be white. To do this open the Outliner window and select the Persp camera. In the attribute editor under the Environment tab slide the Background Color to 100% white.

![aop11](img/maya/rendering/cam.png)

- Now open the Render Globals window and select MentalRay as your renderer and Production as the quality preset. Now change the multipixel filter to "Lanczos". 

![aop12](img/maya/rendering/lanz.png)

- Now close the render Globals window and assign the 'Surface Shader' you have setup to your model. It should turn the model completely black.
#### TWEAKING
- Frame your model and hit render. It should render quickly and look quite grainy.
- Now we need to tweak the settings a little. Open the attribute editor and then in the Hypershade window click on the Ambient Occlusion node. 
- The first setting to change is 'Samples'. Increasing this will remove the grainy look but will drastically increase render times. 256 samples is good for most objects.
- Do not change the 'Bright' and 'Dark' settings. These affect how light/dark the occlusion value is, but it is a lot better to render with the default extremes and tweak them in Photoshop at a later stage if you need to.
- The spread setting affects how far the occlusion shadow spreads over the surface. Again the default setting of 0.800 is good for most objects, any lower tends to be too extreme, and a high spread can cause darkening problems when it is multiplied over your colour layers in Photoshop.

![aop13](img/maya/rendering/ae.png)

#### BAKING TO TEXTURE
Once you have the occlusion looking good in a render, the next stage is to bake it to a texture.
Kind warnings:
- First make sure you have specified a project folder. To do this select File> Set Project, and select a project. This is where your baked texture will automatically be saved. If you forget to set a project folder the bake will be saved in your default projects file in your My Documents folder.     
- Make sure that you have UV mapped your model.     
- Make sure you check the face normals of your model are facing the right way or the bake will produce a black picture.        
- Make sure you have softened the edges of your model and created hard edges where needed.     
- Save a copy of your scene at this stage as Maya can crash while baking to texture.    
Let's do it:
- Now choose the rendering menu set and select Lighting/Shading > Batch Bake (Mental Ray) > Options box The settings should work for most objects.

![aop21](img/maya/rendering/bake.png)

- Select your object in the viewport and hit the 'Convert and Close' button to start baking the occlusion. When you do this Maya will not respond to any clicking, sometimes the screen will go blank and it generally looks like it has crashed but don't worry it will come back eventually. This can take anywhere from a few minutes to a few hours depending on how complex the scene is.

#### USING YOUR BAKED OCCLUSION MAP
- Once the bake is completed open the project file that you specified earlier.     
- In that folder select RenderData > MentalRay > lightmap > select your baked texture file and open this with Photoshop.      
- Drag the Occlusion bake on top of your model's texture layer(s) and select Multiply as the layer blending mode. You may also want to apply a slight Gaussian blur to your occlusion layer, especially if it being used on an organic surface. For hard sharp edged surfaces like this one no blur was applied.

![exr01](img/maya/rendering/AO11.jpg)

#### BAKING OCCLUSION FROM HIGH RES TO LOW RES MODELS
- Ambient occlusion maps can also be used to compliment normal maps. The occlusion values from a high poly model can be baked to the UV layout of a low poly model. This helps to sell the normal mapped details if used in a subtle way. This function is found in the transfer maps window under lighting/shading in the Render menu set.

![exr02](img/maya/rendering/AO12.jpg), ![exr03](img/maya/rendering/AO15.jpg)

## Render Layer Editor
When a shot is animated in a 3D program on a professional production, it is rarely rendered out as is. Instead, the shot is divided into layers and/or render passes. In Maya, the Render Layer Editor allows you to create and manage various render layers and render passes.

![rp01](img/maya/rendering/comp_car_luminance.png), ![rp02](img/maya/rendering/comp_car_shadow.png)
![rp03](img/maya/rendering/comp_car_reflection.png), 

Final realistic render image:

![ex01](img/maya/rendering/GUID-59AF3E15-AFFB-4ABE-BDCC-EED3B16B0B2F-low.png)

## Review
- [Tumblr](http://ant3012.tumblr.com/)

## Homework
1122 - Submit your ambient occlusion render image to Tumblr by next class. 

## Next Class
Global Illumination

## Final project
- Submit one folder (yourname) which includes one pdf documentation, the final render image, maya file + textures.

</div>
<div id="wrapper">
	
	<div class="header">
		
		<h1>ANT3012</h1>		
		<a href="index.html">Overview</a><br/><br/>

		<a href="mayafundt.html">Maya Fundamental</a><br/>
		<a href="mayaNURBs.html">Maya NURBs</a><br/>
		<a href="mayaPoly01.html">Maya Polygon I</a><br/>
		<a href="mayaShade.html">Maya Shading I & Lighting</a><br/>
		<a href="mayaPoly02.html">Maya Polygon II</a><br/>
		<a href="mayaTexture.html">Maya ShadingII: Texturing</a><br/>
		<a href="mayaRender.html">Maya Rendering</a><br/><br/>


	</div>
	<div class="section">
		<script type="text/javascript">
		//var converter = new Markdown.Converter();
		var converter = new Showdown.converter();
		document.write(converter.makeHtml($('#sourcetext').text()));
		</script>
	</div>
	
	<div class="footer">HyunKyung (Haru) Ji, 2013</div>
	
</div>
</body>
</html>